<!-- Polymer dependency -->
<link rel="import" href="bower_components/polymer/polymer-element.html">

<!-- External Polymer Styles/elements dependency -->
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-dropdown-input/paper-dropdown-input.html">
<link rel="import" href="bower_components/paper-styles/color.html">
<link rel="import" href="bower_components/paper-styles/typography.html">
<link rel="import" href="bower_components/paper-styles/default-theme.html">
<link rel="import" href="bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="bower_components/iron-form/iron-form.html">
<link rel="import" href="bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="bower_components/iron-label/iron-label.html">
<link rel="import" href="bower_components/paper-collapse-item/paper-collapse-item.html">
<link rel="import" href="bower_components/paper-dropdown/paper-dropdown.html">



<!--
`<epiviz-chart-settings>` is a view element that manages chart settings. 

All charts implement the `epiviz.ChartSettingsBehavior` that manages this element.
-->
<dom-module id="epiviz-chart-showtracks">

    <template>
        <style>
            paper-dropdown {
                --paper-input-container-label: {
                    /* color: var(--paper-pink-500); */
                    font-style: italic;
                    /* text-align: center; */
                    font-weight: bold;
                    /* width: 150px; */
                };
                --paper-input-container-input: {
                    color: var(--paper-indigo-500);
                    font-style: normal;
                    font-family: serif;
                    text-transform: uppercase;
                    width: 150px;
                };
                /* Only show the underline when focused. */
                --paper-input-container-underline: {
                    display: none;
                    width: 150px;
                };
                --paper-input-container-underline-focus: {
                    border-color: var(--paper-cyan-500);
                    width: 150px;
                };

                --paper-dropdown-menu: {
                    min-width: 100px;
                }

                --paper-listbox: {
                    min-width: 150px;
                }
            }

            paper-item {
                font-style: italic !important;
                font-weight: normal !important;
            }

            paper-item.iron-selected {
                font-style: normal !important;
                font-weight: bold !important;
            }
        </style>

        <!-- local DOM goes here -->
        <paper-dropdown label="Hide/Show Tracks" value="{{selectedItems}}" on-value-changes="_valueChanged" multi no-animations no-label-float>
            <template is="dom-repeat" items="[[items]]">
                <paper-item value$="[[item]]">[[item]]</paper-item>
            </template>
        </paper-dropdown>

    </template>

    <script>
        // Extend Polymer.Element base class
        class EpivizChartShowTracks extends Polymer.Element {

            static get is() { return 'epiviz-chart-showtracks'; }

            static get properties() {
                return {
                    items: {
                        type: Array,
                        notify: true
                    },
                    
                    settings: {
                        type: Object,
                        notify: true
                    },

                    selectedItems: {
                        type: Array,
                        notify: true,
                        observer: "_onSelectedItemsChanged"
                    }
                }
            }

            static get observers() {
                return [
                    /* observer array just like 1.x */
                ]
            }

            constructor() {
                super();
            }

            connectedCallback() {
                super.connectedCallback();
               
                if (this.settings["showTracks"] == "default") {
                    this.shadowRoot.querySelector("paper-dropdown").selectedItems = this.items;
                    // this.selectedItems = this.items;
                } else {
                    this.shadowRoot.querySelector("paper-dropdown").selectedItems = this.settings["showTracks"].split(",");
                    // this.selectedItems = this.settings["showTracks"].split(",");
                }

                // this._parentNode._draw();
            }

            disconnectedCallback() {
                super.connectedCallback();
            }

            /**
             * handles form submit action
             */
            _submit(event) {
                this.$.formSettings.submit();
            }

            _onSelectedItemsChanged(oldVal, newVal) {
                var self = this;
                if (newVal) {
                    this.settings["showTracks"] = newVal.join(",");
                    self._parentNode.chartSettings = this.settings;
                    // TODO: have to force change currently, not sure why!
                    self._parentNode._draw();
                }
            }

            /**
             * handles form submit action
             */
            _form_submit(event) {
                var self = this;
                this.settings["showTracks"] = this.shadowRoot.querySelector("paper-dropdown").selectedItems.join(",");

                this.callback(this.settings);
                this.closeSettings();
            }

            /**
             * handles form cancel action
             */
            _cancel(event) {
                this.closeSettings();
            }

            /**
             * handles form show modal action
             */
            showSettings(target, callback) {
                this.callback = callback;
                this.$.modal.open();
            }

            /**
             * handles form close modal action
             */
            closeSettings() {
                this.$.modal.close();
            }
        };

        customElements.define(EpivizChartShowTracks.is, EpivizChartShowTracks);
    </script>
</dom-module>